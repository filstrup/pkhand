<!DOCTYPE html>
<html>
<body>
<script language="javascript" type="text/javascript">
<!--
/*
  Straight flush > Four > Full > Flush > Straight > Three > Two pair > Pair > High card
  TODO: escaleras king-ace, flujos de juego, parte grafica, combinatoria
*/

var palo;
var jugada = -1;

function arraysIdentical(a, b)
{
  var i = a.length;
  if (i != b.length) return false;
  while (i--)
  {
    if (a[i] !== b[i]) return false;
  }
  return true;
}

function error(arg)
{
  console.log(arg);
}

/*
#####################################################################
#####################################################################
#####################################################################
*/

function generate_card(list)
{
  var result = false;
  var result2;
  var result3;
  var i;
  var j;

  while(!result)
  {
    result2 = false;
    result3 = true;
    i = Math.floor(Math.random() * 13) + 1;
    j = Math.floor(Math.random() * 4) + 1;
    
    for(var k=0; (k < list.length) && (!result2) && (!result3); k++)
    {
      result3 = false;
      if(list[k] == [i, j])
        result2 = true;
      if(k == list.length -1 && !result2)
        result3 = true;
    }
    result = result3;
  }
  if(j == 1)
    j = "spades";
  else if(j == 2)
    j = "hearts";
  else if(j == 3)
    j = "diamonds";
  else if(j == 4)
    j = "clubs";
  return [i, j];
}

function generate_hand(number)
{
  list = [];
  for(i = 1; i <= number; i++)
  {
    list[i] = generate_card(list);
  }
  for(i = 1; i <= number; i++)
  {
    console.log(list[i]);
  }
  return list;
}

function start_arrays(list)
{
  var cards13 = [];
  for(i = 1; i <= 13; i++)
    cards13[i] = 0;

  var cards4 = [];
  for(i = 1; i <= 4; i++)
    cards4[i] = 0;
  
  for(i = 1; i < list.length; i++){
    cont = cards13[list[i][0]];
    cards13[list[i][0]] += 1;
    cards4 = increase4(cont, cards4);
  }
  cards13[0] = list.length - 1;
  cards4[0] = 0;
  
  return [cards13, cards4];
}

function hand (list)
{
  var h = start_arrays(list);
  bestplay(h[0], h[1], list);
}

function increase4(number, list)
{
  switch(number)
  {

    case 0:
      list[1] += 1;
      return list;
      break;

    case 1:
      list[1] -= 1;
      list[2] += 1;
      return list;
      break;

    case 2:
      list[2] -= 1;
      list[3] += 1;
      return list;
      break;

    case 3:
      list[3] -= 1;
      list[4] += 1;
      return list;
      break;

    default:
      error("Error en increase4 con argumento del switch = " + number);
      break;
  }
}

/*
#####################################################################
#####################################################################
#####################################################################
*/

function bestplay(cards, count, list)
{
  console.log(list);
  switch(cards[0])
  {

    case 5:
	  
	    if(escaleraPalo(list)[0] == 1)
	    {
	      jugada = 1;
	      s = escalera(cards)[1];
        if(s == 14)
          console.log("Escalera de palo \"real\": 10 a As" + " (" + palo + ")");
        else
          console.log("Escalera de palo de " + (s-4) + " a " + (s) + " (" + palo + ")");
	    }
	    
      else if (arraysIdentical(count, [0,1,0,0,1]))
      {
	      jugada = 2;
        poker(cards, count); 
      }

      else if (arraysIdentical(count, [0,0,1,1,0]))
      {
	      jugada = 3;
        full(cards, count);
      }
	  
      else if (((escalera(cards))[0]) == 1)
      {
	      jugada = 4;
        s = escalera(cards)[1];
        if(s == 14)
          console.log("Escalera \"real\": 10 a As");
        else
          console.log("Escalera de " + (s-4) + " a " + (s));
      }

      else if (arraysIdentical(count, [0,2,0,1,0]))
      {
	      jugada = 5;
        trio(cards, count);
      }

      else if (arraysIdentical(count, [0,1,2,0,0]))
      {
	      jugada = 6;
        doble(cards, count);
      }

      else if (arraysIdentical(count, [0,3,1,0,0]))
      {
	      jugada = 7;
        pareja(cards, count);
      }
	  
	    else
	    {
	      jugada = 0;
        var j = 13;
        var i = 0;
        console.log(cards);
        if(cards[1] != 0)
          i = "As"
        else
        {
          while(i == 0)
          {
            if(cards[j] != 0)
              i = j;
            j --;
          }
        }
        if(i == 11)
          i = "J";
        else if(i == 12)
          i = "Q";
        else if(i == 13)
          i = "K";
	      console.log("Carta mas alta: " + i);
	    }

      break;

    case 6:

      if(escaleraPalo(list)[0] == 1)
	  {
	    jugada = 1;
	    s = escalera(cards)[1];
      if(s == 14)
        console.log("Escalera de palo \"real\": 10 a As" + " (" + palo + ")");
      else
        console.log("Escalera de palo de " + (s-4) + " a " + (s) + " (" + palo + ")");
	  }
	  
      else if (arraysIdentical(count, [0,2,0,0,1]))
      {
	    jugada = 2;
        poker(cards, count);
      }

      else if (arraysIdentical(count, [0,1,1,1,0]))
      {
	    jugada = 3;
        full(cards, count);
      }
	  
      else if (((escalera(cards))[0]) == 1)
      {
	    jugada = 4;
        s = escalera(cards)[1];
        if(s == 14)
          console.log("Escalera \"real\": 10 a As");
        else
          console.log("Escalera de " + (s-4) + " a " + (s));
      }

      else if (arraysIdentical(count, [0,3,0,1,0]))
      {
	    jugada = 5;
        trio(cards, count);
      }

      else if (arraysIdentical(count, [0,2,2,0,0]))
      {
	    jugada = 6;
        doble(cards, count);
      }

      else if (arraysIdentical(count, [0,4,1,0,0]))
      {
	    jugada = 7;
        pareja(cards, count);
      }
	  
	    else
	    {
	      jugada = 0;
	      console.log("No hay jugada");
	    }
	  
      break;

    case 7:

      if(escaleraPalo(list)[0] == 1)
      {
        jugada = 1;
	      s = escalera(cards)[1];
        if(s == 14)
          console.log("Escalera de palo \"real\": 10 a As" + " (" + palo + ")");
        else
          console.log("Escalera de palo de " + (s-4) + " a " + (s) + " (" + palo + ")");
      }
	  
      else if (arraysIdentical(count, [0,3,0,0,1]))
      {
	    jugada = 2;
        poker(cards, count);
      }

      else if (arraysIdentical(count, [0,2,1,1,0]))
      {
	    jugada = 3;
        full(cards, count);
      }
	  
      else if (((escalera(cards))[0]) == 1)
      {
	    jugada = 4;
        s = escalera(cards)[1];
        if(s == 14)
          console.log("Escalera \"real\": 10 a As");
        else
          console.log("Escalera de " + (s-4) + " a " + (s));
      }

      else if (arraysIdentical(count, [0,4,0,1,0]))
      {
	    jugada = 5;
        trio(cards, count);
      }

      else if (arraysIdentical(count, [0,3,2,0,0]))
      {
	    jugada = 6;
        doble(cards, count);
      }

      else if (arraysIdentical(count, [0,5,1,0,0]))
      {
	    jugada = 7;
        pareja(cards, count);
      }
	  
	  else
	  {
	    jugada = 0;
	    console.log("No hay jugada");
	  }
	  
      break;
 
    default:
      error("Error en el numero de cartas en la mano = " + cards[0]);
      break;
  }
}

/*
#####################################################################
#####################################################################
#####################################################################
*/

function poker(cards, count)
{
  hc = 0;
  result = false;
  for(i = 1; !result; i++)
  {
    result = (cards[i] == 4);
    hc = i;
  }
  play = "Poker de " + hc;
  console.log(play);
}

function full(cards, count)
{
  hc = 0;
  hc2 = 0;
  result = false;
  result2 = false;
  for(i = 1; !result || !result2 ; i++)
  {
    if(cards[i] == 3)
    {
    result = true;
    hc = i; 
    }
    if(cards[i] == 2)
    {
    result2 = true;
    hc2 = i; 
    }
  }
  play = "Full de " + hc + " (trio) y " + hc2 + " (pareja)";
  console.log(play);
}

function trio(cards, count)
{
  hc = 0;
  result = false;
  for(i = 1; !result; i++)
  {
    result = (cards[i] == 3);
    hc = i;
  }
  play = "Trio de " + hc;
  console.log(play);
}

function doble(cards, count)
{
  hc = 0;
  hc2 = 0;
  result = false;
  result2 = false;
  for(i = 1; !result || !result2 ; i++)
  {
    if(cards[i] == 2 && !result)
    {
      result = true;
      hc = i; 
    }
    else if(cards[i] == 2 && result)
    {
      result2 = true;
      hc2 = i; 
    }
  }
  play = "Parejas dobles " + hc + " y " + hc2;
  console.log(play);
}

function pareja(cards, count)
{
  hc = 0;
  result = false;
  for(i = 1; !result; i++)
  {
    result = (cards[i] == 2);
    hc = i;
  }
  play = "Pareja de " + hc;
  console.log(play);
}

function escalera(cards)
{
  var k = 0;
  var s = 0;
  for(i = 1; i < cards.length; i++)
  {
    if (cards[i] >= 1)
    {
      k++;
      if(k >= 5)
	    {
	      s = i;
	    }
    }
    else if(cards[i] == 0)
    {
      k = 0;
    }
  }
  if(k>=4 || s!= 0)
  {
    if (k >= 4 && (cards[1] >= 1) )
      s = 14;
    var list = [1, s];
    return list; 
  }
  else
  {
    return [0, 0];
  }
}

function escaleraPalo(list)
{
  var nList = [];
  
  var hearts = 0;
  var spades = 0;
  var diamonds = 0;
  var clubs = 0;
  
  var temp;
  
  for(i = 1; i < list.length; i++)
  {
    if (list[i][1] == "hearts")
	  hearts ++;
	else if (list[i][1] == "spades")
	  spades ++;
	else if (list[i][1] == "clubs")
	  clubs ++;
	else if (list[i][1] == "diamonds")
	  diamonds ++;
  }
  
  if (hearts >= 5)
    temp = "hearts";
  else if (spades >= 5)
    temp = "spades";
  else if (clubs >= 5)
    temp = "clubs";
  else if (diamonds >= 5)
    temp = "diamonds";
  
  var j = 1;
  for(i = 1; i < list.length; i++)
  {
    if(list[i][1] == temp)
	{
	  nList[j] = list[i];
	  j++;
	}
  }
  palo = temp;
  return escalera(start_arrays(nList)[0]);
}

/*
#####################################################################
#####################################################################
#####################################################################
*/

/*
hand([5, [1, "hearts"], [10, "hearts"], [11, "hearts"], [12, "hearts"], [13, "hearts"]]);
console.log("\n");
console.log("\n");
hand([6, [1, "hearts"], [10, "hearts"], [11, "hearts"], [12, "hearts"], [13, "hearts"], [9, "hearts"]]);
console.log("\n");
console.log("\n");
hand([7, [1, "hearts"], [10, "hearts"], [11, "hearts"], [12, "hearts"], [13, "hearts"], [9, "hearts"], [8, "hearts"]]);
console.log("\n");
console.log("\n");
hand([5, [1, "hearts"], [10, "clubs"], [11, "hearts"], [12, "spades"], [13, "hearts"]]);
console.log("\n");
console.log("\n");
hand([6, [1, "hearts"], [10, "hearts"], [11, "hearts"], [12, "diamonds"], [13, "clubs"], [9, "hearts"]]);
console.log("\n");
console.log("\n");
hand([7, [1, "hearts"], [10, "hearts"], [11, "spades"], [12, "hearts"], [13, "hearts"], [9, "hearts"], [8, "hearts"]]);
*/

hand(generate_hand(5));
console.log("\n");
console.log("\n");
hand(generate_hand(5));
console.log("\n");
console.log("\n");
hand(generate_hand(5));
console.log("\n");
console.log("\n");
//-->
</script>
</body>
</html> 
